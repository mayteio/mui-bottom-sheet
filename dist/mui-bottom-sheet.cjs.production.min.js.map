{"version":3,"file":"mui-bottom-sheet.cjs.production.min.js","sources":["../src/util.ts","../src/BottomSheet.tsx"],"sourcesContent":["/**\n * Find the closest value in an array to a given value\n * @param goal target value\n * @param numbers array of numbers to search through\n */\nexport const closest = (goal: number, numbers: number[]) =>\n  numbers.reduce((prev, pos) =>\n    Math.abs(pos - goal) < Math.abs(prev - goal) ? pos : prev\n  );\n","import React, { FC, ReactElement, useEffect, useRef } from 'react';\nimport { a, useSpring, config } from 'react-spring';\nimport { useDrag } from 'react-use-gesture';\nimport useMeasure from 'react-use-measure';\nimport { ResizeObserver } from '@juggle/resize-observer';\nimport { closest } from './util';\n\nexport interface bottomSheetOptions {\n  /**\n   * Show backdrop that darkens as the sheet is pulled up. Defaults to true.\n   *\n   * @default true\n   */\n  backdrop?: boolean;\n\n  /**\n   * Background component behind sheet. Requires at least two `peekHeights`.\n   * @default null\n   */\n  background?: ReactElement;\n\n  /**\n   * Current peek index if you want to control the component.\n   * @default 0;\n   */\n  currentIndex?: number;\n\n  /**\n   * Sheet height when in closed state.\n   * @default 100\n   */\n  defaultHeight: number;\n\n  /**\n   * Whether to go allow sheet to go full screen. If false, sheet will max out at largest peekHeight.\n   * @default true\n   */\n  fullHeight: boolean;\n\n  /**\n   * Completely hides the sheet when true.\n   * @default false\n   */\n  hidden: boolean | number;\n\n  /**\n   * Called when the user interacts and moves the bottomsheet to a new peek height\n   */\n  onIndexChange?: (index: number) => void;\n\n  /**\n   * Sheet will stop at certain heights to reveal more info.\n   * @default []\n   */\n  peekHeights?: number[];\n\n  /**\n   * Which spring config to use for snapping the sheet\n   * @default config.stiff\n   */\n  springConfig: Record<string, any>;\n\n  /**\n   * User styles for root, background and backdrop.\n   * @default {root:{},background:{},backdrop:{}}\n   */\n  styles?: bottomSheetStyles;\n\n  /**\n   * Threshold for over-dragging the sheet before snapping to closest height.\n   * @default 70\n   */\n  threshold: number;\n}\n\nexport interface BottomSheetProps extends Partial<bottomSheetOptions> {}\n\nexport interface bottomSheetStyles {\n  backdrop?: Record<string, any>;\n  background?: Record<string, any>;\n  root?: Record<string, any>;\n}\n\n/** Some sensible defaults */\nexport const defaultOptions = {\n  backdrop: true,\n  background: null,\n  defaultHeight: 100,\n  fullHeight: true,\n  hidden: false,\n  peekHeights: [],\n  springConfig: config.stiff,\n  styles: { root: {}, backdrop: {}, background: {} },\n  threshold: 70,\n};\n\nexport const BottomSheet: FC<BottomSheetProps> = props => {\n  /** Merge defaults and provided options */\n  const {\n    backdrop,\n    background,\n    currentIndex,\n    defaultHeight,\n    fullHeight,\n    hidden,\n    onIndexChange,\n    peekHeights,\n    springConfig,\n    styles: userStyles,\n    threshold,\n  } = {\n    ...defaultOptions,\n    ...props,\n  };\n\n  /** Generate stylesheet */\n  const styles: bottomSheetStyles = {\n    backdrop: {\n      position: 'fixed' as React.CSSProperties['position'],\n      bottom: 0,\n      left: 0,\n      right: 0,\n      top: 0,\n      zIndex: 1198,\n      backgroundColor: 'rgba(0,0,0,0.3)',\n    },\n    background: {\n      position: 'fixed' as React.CSSProperties['position'],\n      zIndex: 1199,\n      left: 0,\n      top: 0,\n      width: '100%',\n    },\n    root: {\n      background: '#fff',\n      boxShadow: '0 -10px 20px rgba(0,0,0,0.3)',\n      width: '100%',\n      minHeight: defaultHeight,\n      maxHeight: '100%',\n      position: 'fixed' as React.CSSProperties['position'],\n      left: 0,\n      top: 0,\n      zIndex: 1200,\n    },\n  };\n\n  /** generate stop position relative to window height */\n  const stopPosition = (relativeHeight: number) =>\n    window.innerHeight - relativeHeight;\n\n  /** Create array of possible stop positions */\n  const defaultPosition = stopPosition(defaultHeight);\n  const stops = [defaultPosition];\n\n  /** Track heights */\n  const [measureRef, { height }] = useMeasure({ polyfill: ResizeObserver });\n\n  let max = 0;\n  /** If it's taller than the window, clamp the stops at full screen */\n  if (height > window.innerHeight && fullHeight) {\n    stops.push(0);\n  }\n\n  /** If the el is smaller than the window and larger than the default, add it as a stop. */\n  if (height < window.innerHeight && height > defaultHeight) {\n    max = stopPosition(height);\n    stops.push(max);\n  }\n\n  /** Add peek heights if they are less than the max height */\n  peekHeights?.sort().forEach(peekHeight => {\n    if (peekHeight < height && peekHeight < window.innerHeight) {\n      stops.push(stopPosition(peekHeight));\n    }\n  });\n\n  /** Track container scroll to prevent pulling when not at scrollTop */\n  const containerRef = useRef<HTMLDivElement | null>(null);\n\n  /** Track animateable styles */\n  const [{ y }, set] = useSpring(() => ({\n    y: defaultPosition,\n  }));\n\n  /** Handle draging */\n  const bind = useDrag(\n    ({ last, cancel, movement: [, my], direction: [dx] }) => {\n      /** If the drag is feeling more horizontal than vertical, cancel */\n      if (dx < -0.8 || dx > 0.8) {\n        cancel && cancel();\n      }\n\n      /** Prevent drag if container isn't at top of scroll */\n      if (containerRef?.current?.scrollTop) {\n        return;\n      }\n\n      /**\n       * Cancel the drag if we either hit the top of the screen\n       * or a certain threshold above the max height (Defaults to 70px)\n       */\n      if (my < 0 || my < Math.min(...stops) - threshold) {\n        cancel && cancel();\n      }\n\n      /** On release, snap to closest stop position */\n      if (last) {\n        const lastPosition = closest(my, stops);\n        set({\n          y: lastPosition,\n          config: springConfig,\n        });\n\n        /** Call onIndexChange if it's set */\n        onIndexChange &&\n          onIndexChange(stops.findIndex(stop => stop === lastPosition));\n        return;\n      }\n\n      /** On each frame, set the y position */\n      set({\n        y: my,\n        config: { duration: 0 },\n      });\n    },\n    {\n      /**\n       * If the container has been scrolled, we want the sheet\n       * to begin pulling down once the users gets back to the\n       * top of the scroll. initialising the my position as the\n       * negative value of the current scroll sets it to zero\n       * when the user gets to the top of the scrollable area.\n       */\n      initial: () => [\n        0,\n        containerRef.current?.scrollTop\n          ? -containerRef.current.scrollTop + Math.min(...stops)\n          : y.goal,\n      ],\n      bounds: { top: 0 },\n    }\n  );\n\n  /** If the hidden prop is true, hide the entire sheet off-screen */\n  useEffect(() => {\n    set({\n      y: hidden ? window.innerHeight + 30 : defaultPosition,\n      config: config.gentle,\n    });\n  }, [hidden, set, defaultPosition]);\n\n  /** Set display:none when the drawer is hidden. */\n  const display = y.to(py => (py < window.innerHeight + 30 ? 'block' : 'none'));\n\n  /**\n   * Lock the scroll of the bottom sheet while it hasn't been\n   * pulled to its maximum possible height.\n   */\n  const overflowY = y.to(v => (v > Math.min(...stops) ? 'hidden' : 'scroll'));\n\n  /** Aggregate main sheet props into an object for spreading */\n  const sheetStyle = {\n    y,\n    display,\n    overflowY,\n  };\n\n  /** Animated styles for the backdrop based off the y position */\n  const backdropActiveAt = stops\n    .sort()\n    .reverse()\n    .find(n => n !== defaultPosition && n < defaultPosition);\n\n  const backdropStyle = {\n    /** backdrop should only begin to fade in after first stop */\n    opacity: y.to([(backdropActiveAt as number) || 0, defaultPosition], [1, 0]),\n    /** Set display none when backdrop isn't show so you can interact with the page */\n    display: y.to(py => (py < defaultPosition && backdrop ? 'block' : 'none')),\n  };\n\n  /**\n   * Background is an image or carousel that slides up behind the main\n   * bottom sheet, similar to the venue images on Google maps.\n   */\n  const backgroundStyle = {\n    height: Math.min(...stops.filter(n => n > 0)),\n    y: y.to(\n      [...stops].reverse(),\n      stops.map((_stop, i, arr) =>\n        i === arr.length - 1 || i === arr.length - 2 ? window.innerHeight : 0\n      ),\n      'clamp'\n    ),\n  };\n\n  /**\n   * Handle controlled component changes\n   */\n  useEffect(() => {\n    if (currentIndex !== undefined && y.goal !== stops[currentIndex]) {\n      if (!stops[currentIndex]) {\n        console.warn('No stop exists for the index you set.');\n      }\n      set({\n        y: stops[currentIndex],\n        config: springConfig,\n      });\n    }\n  }, [currentIndex, stops, set, y]);\n\n  return (\n    <>\n      <a.div\n        {...bind()}\n        ref={containerRef}\n        style={{ ...styles.root, ...userStyles.root, y, ...sheetStyle }}\n      >\n        <div ref={measureRef}>{props.children}</div>\n      </a.div>\n      {background && (\n        <a.div\n          style={{\n            ...styles.background,\n            ...userStyles.background,\n            ...backgroundStyle,\n          }}\n          className=\"background\"\n        >\n          {background}\n        </a.div>\n      )}\n      <a.div\n        style={{ ...styles.backdrop, ...userStyles.backdrop, ...backdropStyle }}\n      />\n    </>\n  );\n};\n"],"names":["defaultOptions","backdrop","background","defaultHeight","fullHeight","hidden","peekHeights","springConfig","config","stiff","styles","root","threshold","props","currentIndex","onIndexChange","userStyles","position","bottom","left","right","top","zIndex","backgroundColor","width","boxShadow","minHeight","maxHeight","stopPosition","relativeHeight","window","innerHeight","defaultPosition","stops","useMeasure","polyfill","ResizeObserver","measureRef","height","max","push","sort","forEach","peekHeight","containerRef","useRef","useSpring","y","set","bind","useDrag","last","cancel","my","movement","dx","direction","current","_containerRef$current","scrollTop","Math","min","lastPosition","goal","reduce","prev","pos","abs","findIndex","stop","duration","initial","bounds","useEffect","gentle","display","to","py","overflowY","v","sheetStyle","backdropActiveAt","reverse","find","n","backdropStyle","opacity","backgroundStyle","filter","map","_stop","i","arr","length","undefined","console","warn","React","a","div","ref","style","children","className"],"mappings":"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"}